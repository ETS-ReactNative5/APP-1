{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\chlx9\\\\Documents\\\\apph\\\\src\\\\pages\\\\Classify.js\";\nimport React, { Component, Fragment } from 'react';\nimport { Alert, Button, Collapse, Container, Form, Spinner, ListGroup, Tabs, Tab } from 'react-bootstrap';\nimport { FaCamera, FaChevronDown, FaChevronRight } from 'react-icons/fa';\nimport { openDB } from 'idb';\nimport Cropper from 'react-cropper';\nimport * as tf from '@tensorflow/tfjs';\nimport LoadButton from '../components/LoadButton';\nimport { MODEL_CLASSES } from '../model/classes';\nimport config from '../config';\nimport './Classify.css';\nimport 'cropperjs/dist/cropper.css';\nconst MODEL_PATH = '/model/model.json';\nconst IMAGE_SIZE = 224;\nconst CANVAS_SIZE = 224;\nconst TOPK_PREDICTIONS = 5;\nconst INDEXEDDB_DB = 'tensorflowjs';\nconst INDEXEDDB_STORE = 'model_info_store';\nconst INDEXEDDB_KEY = 'web-model';\n/**\n * Class to handle the rendering of the Classify page.\n * @extends React.Component\n */\n\nexport default class Classify extends Component {\n  constructor(props) {\n    super(props);\n\n    this.initWebcam = async () => {\n      try {\n        this.webcam = await tf.data.webcam(this.refs.webcam, {\n          resizeWidth: CANVAS_SIZE,\n          resizeHeight: CANVAS_SIZE,\n          facingMode: 'environment'\n        });\n      } catch (e) {\n        this.refs.noWebcam.style.display = 'block';\n      }\n    };\n\n    this.startWebcam = async () => {\n      if (this.webcam) {\n        this.webcam.start();\n      }\n    };\n\n    this.stopWebcam = async () => {\n      if (this.webcam) {\n        this.webcam.stop();\n      }\n    };\n\n    this.getModelInfo = async () => {\n      await fetch(`${config.API_ENDPOINT}/model_info`, {\n        method: 'GET'\n      }).then(async response => {\n        await response.json().then(data => {\n          this.modelLastUpdated = data.last_updated;\n        }).catch(err => {\n          console.log('Unable to get parse model info.');\n        });\n      }).catch(err => {\n        console.log('Unable to get model info');\n      });\n    };\n\n    this.updateModel = async () => {\n      // Get the latest model from the server and refresh the one saved in IndexedDB.\n      console.log('Updating the model: ' + INDEXEDDB_KEY);\n      this.setState({\n        isDownloadingModel: true\n      });\n      this.model = await tf.loadLayersModel(MODEL_PATH);\n      await this.model.save('indexeddb://' + INDEXEDDB_KEY);\n      this.setState({\n        isDownloadingModel: false,\n        modelUpdateAvailable: false,\n        showModelUpdateAlert: false,\n        showModelUpdateSuccess: true\n      });\n    };\n\n    this.classifyLocalImage = async () => {\n      this.setState({\n        isClassifying: true\n      });\n      const croppedCanvas = this.refs.cropper.getCroppedCanvas();\n      const image = tf.tidy(() => tf.browser.fromPixels(croppedCanvas).toFloat()); // Process and resize image before passing in to model.\n\n      const imageData = await this.processImage(image);\n      const resizedImage = tf.image.resizeBilinear(imageData, [IMAGE_SIZE, IMAGE_SIZE]);\n      const logits = this.model.predict(resizedImage);\n      const probabilities = await logits.data();\n      const preds = await this.getTopKClasses(probabilities, TOPK_PREDICTIONS);\n      this.setState({\n        predictions: preds,\n        isClassifying: false,\n        photoSettingsOpen: !this.state.photoSettingsOpen\n      }); // Draw thumbnail to UI.\n\n      const context = this.refs.canvas.getContext('2d');\n      const ratioX = CANVAS_SIZE / croppedCanvas.width;\n      const ratioY = CANVAS_SIZE / croppedCanvas.height;\n      const ratio = Math.min(ratioX, ratioY);\n      context.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n      context.drawImage(croppedCanvas, 0, 0, croppedCanvas.width * ratio, croppedCanvas.height * ratio); // Dispose of tensors we are finished with.\n\n      image.dispose();\n      imageData.dispose();\n      resizedImage.dispose();\n      logits.dispose();\n    };\n\n    this.classifyWebcamImage = async () => {\n      this.setState({\n        isClassifying: true\n      });\n      const imageCapture = await this.webcam.capture();\n      const resized = tf.image.resizeBilinear(imageCapture, [IMAGE_SIZE, IMAGE_SIZE]);\n      const imageData = await this.processImage(resized);\n      const logits = this.model.predict(imageData);\n      const probabilities = await logits.data();\n      const preds = await this.getTopKClasses(probabilities, TOPK_PREDICTIONS);\n      this.setState({\n        predictions: preds,\n        isClassifying: false,\n        photoSettingsOpen: !this.state.photoSettingsOpen\n      }); // Draw thumbnail to UI.\n\n      const tensorData = tf.tidy(() => imageCapture.toFloat().div(255));\n      await tf.browser.toPixels(tensorData, this.refs.canvas); // Dispose of tensors we are finished with.\n\n      resized.dispose();\n      imageCapture.dispose();\n      imageData.dispose();\n      logits.dispose();\n      tensorData.dispose();\n    };\n\n    this.processImage = async image => {\n      return tf.tidy(() => image.expandDims(0).toFloat().div(127).sub(1));\n    };\n\n    this.getTopKClasses = async (values, topK) => {\n      const valuesAndIndices = [];\n\n      for (let i = 0; i < values.length; i++) {\n        valuesAndIndices.push({\n          value: values[i],\n          index: i\n        });\n      }\n\n      valuesAndIndices.sort((a, b) => {\n        return b.value - a.value;\n      });\n      const topkValues = new Float32Array(topK);\n      const topkIndices = new Int32Array(topK);\n\n      for (let i = 0; i < topK; i++) {\n        topkValues[i] = valuesAndIndices[i].value;\n        topkIndices[i] = valuesAndIndices[i].index;\n      }\n\n      const topClassesAndProbs = [];\n\n      for (let i = 0; i < topkIndices.length; i++) {\n        topClassesAndProbs.push({\n          className: MODEL_CLASSES[topkIndices[i]],\n          probability: (topkValues[i] * 100).toFixed(2)\n        });\n      }\n\n      return topClassesAndProbs;\n    };\n\n    this.handlePanelClick = event => {\n      this.setState({\n        photoSettingsOpen: !this.state.photoSettingsOpen\n      });\n    };\n\n    this.handleFileChange = event => {\n      if (event.target.files && event.target.files.length > 0) {\n        this.setState({\n          file: URL.createObjectURL(event.target.files[0]),\n          filename: event.target.files[0].name\n        });\n      }\n    };\n\n    this.handleTabSelect = activeKey => {\n      switch (activeKey) {\n        case 'camera':\n          this.startWebcam();\n          break;\n\n        case 'localfile':\n          this.setState({\n            filename: null,\n            file: null\n          });\n          this.stopWebcam();\n          break;\n\n        default:\n      }\n    };\n\n    this.webcam = null;\n    this.model = null;\n    this.modelLastUpdated = null;\n    this.state = {\n      modelLoaded: false,\n      filename: '',\n      isModelLoading: false,\n      isClassifying: false,\n      predictions: [],\n      photoSettingsOpen: true,\n      modelUpdateAvailable: false,\n      showModelUpdateAlert: false,\n      showModelUpdateSuccess: false,\n      isDownloadingModel: false\n    };\n  }\n\n  async componentDidMount() {\n    if ('indexedDB' in window) {\n      try {\n        this.model = await tf.loadLayersModel('indexeddb://' + INDEXEDDB_KEY); // Safe to assume tensorflowjs database and related object store exists.\n        // Get the date when the model was saved.\n\n        try {\n          const db = await openDB(INDEXEDDB_DB, 1);\n          const item = await db.transaction(INDEXEDDB_STORE).objectStore(INDEXEDDB_STORE).get(INDEXEDDB_KEY);\n          const dateSaved = new Date(item.modelArtifactsInfo.dateSaved);\n          await this.getModelInfo();\n          console.log(this.modelLastUpdated);\n\n          if (!this.modelLastUpdated || dateSaved >= new Date(this.modelLastUpdated).getTime()) {\n            console.log('Using saved model');\n          } else {\n            this.setState({\n              modelUpdateAvailable: true,\n              showModelUpdateAlert: true\n            });\n          }\n        } catch (error) {\n          console.warn(error);\n          console.warn('Could not retrieve when model was saved.');\n        }\n      } // If error here, assume that the object store doesn't exist and the model currently isn't\n      // saved in IndexedDB.\n      catch (error) {\n        console.log('Not found in IndexedDB. Loading and saving...');\n        console.log(error);\n        this.model = await tf.loadLayersModel(MODEL_PATH);\n        await this.model.save('indexeddb://' + INDEXEDDB_KEY);\n      }\n    } // If no IndexedDB, then just download like normal.\n    else {\n        console.warn('IndexedDB not supported.');\n        this.model = await tf.loadLayersModel(MODEL_PATH);\n      }\n\n    this.setState({\n      modelLoaded: true\n    });\n    this.initWebcam(); // Warm up model.\n\n    let prediction = tf.tidy(() => this.model.predict(tf.zeros([1, IMAGE_SIZE, IMAGE_SIZE, 3])));\n    prediction.dispose();\n  }\n\n  async componentWillUnmount() {\n    if (this.webcam) {\n      this.webcam.stop();\n    } // Attempt to dispose of the model.\n\n\n    try {\n      this.model.dispose();\n    } catch (e) {// Assume model is not loaded or already disposed.\n    }\n  }\n\n  render() {\n    return (\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"Classify container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 304,\n          columnNumber: 7\n        }\n      }, !this.state.modelLoaded &&\n      /*#__PURE__*/\n      React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307,\n          columnNumber: 9\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Spinner, {\n        animation: \"border\",\n        role: \"status\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308,\n          columnNumber: 11\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"span\", {\n        className: \"sr-only\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 13\n        }\n      }, \"Cargando...\")), ' ',\n      /*#__PURE__*/\n      React.createElement(\"span\", {\n        className: \"loading-model-text\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311,\n          columnNumber: 16\n        }\n      }, \"Cargando Modelo\")), this.state.modelLoaded &&\n      /*#__PURE__*/\n      React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 9\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Button, {\n        variant: \"primary\",\n        onClick: this.handlePanelClick,\n        className: \"classify-panel-header\",\n        \"aria-controls\": \"photo-selection-pane\",\n        \"aria-expanded\": this.state.photoSettingsOpen,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 9\n        }\n      }, \"Toma o selecciona una foto para clasificar\",\n      /*#__PURE__*/\n      React.createElement(\"span\", {\n        className: \"panel-arrow\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 13\n        }\n      }, this.state.photoSettingsOpen ?\n      /*#__PURE__*/\n      React.createElement(FaChevronDown, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 17\n        }\n      }) :\n      /*#__PURE__*/\n      React.createElement(FaChevronRight, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 17\n        }\n      }))),\n      /*#__PURE__*/\n      React.createElement(Collapse, {\n        \"in\": this.state.photoSettingsOpen,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 332,\n          columnNumber: 11\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        id: \"photo-selection-pane\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 13\n        }\n      }, this.state.modelUpdateAvailable && this.state.showModelUpdateAlert &&\n      /*#__PURE__*/\n      React.createElement(Container, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Alert, {\n        variant: \"info\",\n        show: this.state.modelUpdateAvailable && this.state.showModelUpdateAlert,\n        onClose: () => this.setState({\n          showModelUpdateAlert: false\n        }),\n        dismissible: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 19\n        }\n      }, \"An update for the \",\n      /*#__PURE__*/\n      React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 341,\n          columnNumber: 41\n        }\n      }, this.state.modelType), \" El modelo esta disponible.\",\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"d-flex justify-content-center pt-1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 23\n        }\n      }, !this.state.isDownloadingModel &&\n      /*#__PURE__*/\n      React.createElement(Button, {\n        onClick: this.updateModel,\n        variant: \"outline-info\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 27\n        }\n      }, \"Update\"), this.state.isDownloadingModel &&\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 27\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Spinner, {\n        animation: \"border\",\n        role: \"status\",\n        size: \"sm\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 351,\n          columnNumber: 29\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"span\", {\n        className: \"sr-only\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 352,\n          columnNumber: 31\n        }\n      }, \"Descargando...\")), ' ',\n      /*#__PURE__*/\n      React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 34\n        }\n      }, \"Descargando...\"))))), this.state.showModelUpdateSuccess &&\n      /*#__PURE__*/\n      React.createElement(Container, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Alert, {\n        variant: \"success\",\n        onClose: () => this.setState({\n          showModelUpdateSuccess: false\n        }),\n        dismissible: true,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 363,\n          columnNumber: 19\n        }\n      }, \"The \",\n      /*#__PURE__*/\n      React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 366,\n          columnNumber: 25\n        }\n      }, this.state.modelType), \" El modelo se ha actualizado!\")),\n      /*#__PURE__*/\n      React.createElement(Tabs, {\n        defaultActiveKey: \"camera\",\n        id: \"input-options\",\n        onSelect: this.handleTabSelect,\n        className: \"justify-content-center\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 13\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Tab, {\n        eventKey: \"camera\",\n        title: \"Tomar Foto\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 15\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        id: \"no-webcam\",\n        ref: \"noWebcam\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"span\", {\n        className: \"camera-icon\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 19\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(FaCamera, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 49\n        }\n      })), \"No se detect\\xF3 una camara. \",\n      /*#__PURE__*/\n      React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 375,\n          columnNumber: 45\n        }\n      }), \"Por favor use un dispositivo o cargue una imagen.\"),\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"webcam-box-outer\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 378,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"webcam-box-inner\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 19\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"video\", {\n        ref: \"webcam\",\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        id: \"webcam\",\n        width: \"448\",\n        height: \"448\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 21\n        }\n      }))),\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"button-container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(LoadButton, {\n        variant: \"custom\",\n        size: \"lg\",\n        onClick: this.classifyWebcamImage,\n        isLoading: this.state.isClassifying,\n        text: \"Clasifcar\",\n        loadingText: \"Clasificando...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 386,\n          columnNumber: 19\n        }\n      }))),\n      /*#__PURE__*/\n      React.createElement(Tab, {\n        eventKey: \"localfile\",\n        title: \"Selecccionar del dispositivo\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 397,\n          columnNumber: 15\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Form.Group, {\n        controlId: \"file\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 17\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Form.Label, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 19\n        }\n      }, \"Seleccionar un archivo\"),\n      /*#__PURE__*/\n      React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 66\n        }\n      }),\n      /*#__PURE__*/\n      React.createElement(Form.Label, {\n        className: \"imagelabel\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 19\n        }\n      }, this.state.filename ? this.state.filename : 'Buscar...'),\n      /*#__PURE__*/\n      React.createElement(Form.Control, {\n        onChange: this.handleFileChange,\n        type: \"file\",\n        accept: \"image/*\",\n        className: \"imagefile\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 403,\n          columnNumber: 19\n        }\n      })), this.state.file &&\n      /*#__PURE__*/\n      React.createElement(Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 19\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        id: \"local-image\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 21\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(Cropper, {\n        ref: \"cropper\",\n        src: this.state.file,\n        style: {\n          height: 400,\n          width: '100%'\n        },\n        guides: true,\n        aspectRatio: 1 / 1,\n        viewMode: 2,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 412,\n          columnNumber: 23\n        }\n      })),\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"button-container\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 21\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(LoadButton, {\n        variant: \"primary\",\n        size: \"lg\",\n        disabled: !this.state.filename,\n        onClick: this.classifyLocalImage,\n        isLoading: this.state.isClassifying,\n        text: \"Clasificar\",\n        loadingText: \"Clasificando...\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 23\n        }\n      }))))))), this.state.predictions.length > 70 &&\n      /*#__PURE__*/\n      React.createElement(\"div\", {\n        className: \"classification-results\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 439,\n          columnNumber: 13\n        }\n      },\n      /*#__PURE__*/\n      React.createElement(\"h3\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 15\n        }\n      }, \"Predicciones\"),\n      /*#__PURE__*/\n      React.createElement(\"canvas\", {\n        ref: \"canvas\",\n        width: CANVAS_SIZE,\n        height: CANVAS_SIZE,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 441,\n          columnNumber: 15\n        }\n      }),\n      /*#__PURE__*/\n      React.createElement(\"br\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 442,\n          columnNumber: 15\n        }\n      }),\n      /*#__PURE__*/\n      React.createElement(ListGroup, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 15\n        }\n      }, this.state.predictions.map(category => {\n        return (\n          /*#__PURE__*/\n          React.createElement(ListGroup.Item, {\n            key: category.className,\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 446,\n              columnNumber: 21\n            }\n          },\n          /*#__PURE__*/\n          React.createElement(\"strong\", {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 447,\n              columnNumber: 23\n            }\n          }, category.className), \" \", category.probability, \"%\")\n        );\n      })))))\n    );\n  }\n\n}","map":{"version":3,"sources":["C:\\Users\\chlx9\\Documents\\apph\\src\\pages\\Classify.js"],"names":["React","Component","Fragment","Alert","Button","Collapse","Container","Form","Spinner","ListGroup","Tabs","Tab","FaCamera","FaChevronDown","FaChevronRight","openDB","Cropper","tf","LoadButton","MODEL_CLASSES","config","MODEL_PATH","IMAGE_SIZE","CANVAS_SIZE","TOPK_PREDICTIONS","INDEXEDDB_DB","INDEXEDDB_STORE","INDEXEDDB_KEY","Classify","constructor","props","initWebcam","webcam","data","refs","resizeWidth","resizeHeight","facingMode","e","noWebcam","style","display","startWebcam","start","stopWebcam","stop","getModelInfo","fetch","API_ENDPOINT","method","then","response","json","modelLastUpdated","last_updated","catch","err","console","log","updateModel","setState","isDownloadingModel","model","loadLayersModel","save","modelUpdateAvailable","showModelUpdateAlert","showModelUpdateSuccess","classifyLocalImage","isClassifying","croppedCanvas","cropper","getCroppedCanvas","image","tidy","browser","fromPixels","toFloat","imageData","processImage","resizedImage","resizeBilinear","logits","predict","probabilities","preds","getTopKClasses","predictions","photoSettingsOpen","state","context","canvas","getContext","ratioX","width","ratioY","height","ratio","Math","min","clearRect","drawImage","dispose","classifyWebcamImage","imageCapture","capture","resized","tensorData","div","toPixels","expandDims","sub","values","topK","valuesAndIndices","i","length","push","value","index","sort","a","b","topkValues","Float32Array","topkIndices","Int32Array","topClassesAndProbs","className","probability","toFixed","handlePanelClick","event","handleFileChange","target","files","file","URL","createObjectURL","filename","name","handleTabSelect","activeKey","modelLoaded","isModelLoading","componentDidMount","window","db","item","transaction","objectStore","get","dateSaved","Date","modelArtifactsInfo","getTime","error","warn","prediction","zeros","componentWillUnmount","render","modelType","map","category"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SACEC,KADF,EACSC,MADT,EACiBC,QADjB,EAC2BC,SAD3B,EACsCC,IADtC,EAC4CC,OAD5C,EACqDC,SADrD,EACgEC,IADhE,EACsEC,GADtE,QAEO,iBAFP;AAGA,SAASC,QAAT,EAAmBC,aAAnB,EAAkCC,cAAlC,QAAwD,gBAAxD;AACA,SAASC,MAAT,QAAuB,KAAvB;AACA,OAAOC,OAAP,MAAqB,eAArB;AACA,OAAO,KAAKC,EAAZ,MAAoB,kBAApB;AACA,OAAOC,UAAP,MAAuB,0BAAvB;AACA,SAASC,aAAT,QAA8B,kBAA9B;AACA,OAAOC,MAAP,MAAmB,WAAnB;AACA,OAAO,gBAAP;AACA,OAAO,4BAAP;AAGA,MAAMC,UAAU,GAAG,mBAAnB;AACA,MAAMC,UAAU,GAAG,GAAnB;AACA,MAAMC,WAAW,GAAG,GAApB;AACA,MAAMC,gBAAgB,GAAG,CAAzB;AAEA,MAAMC,YAAY,GAAG,cAArB;AACA,MAAMC,eAAe,GAAG,kBAAxB;AACA,MAAMC,aAAa,GAAG,WAAtB;AAEA;;;;;AAIA,eAAe,MAAMC,QAAN,SAAuB3B,SAAvB,CAAiC;AAE9C4B,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SA0FnBC,UA1FmB,GA0FN,YAAY;AACvB,UAAI;AACF,aAAKC,MAAL,GAAc,MAAMf,EAAE,CAACgB,IAAH,CAAQD,MAAR,CAClB,KAAKE,IAAL,CAAUF,MADQ,EAElB;AAACG,UAAAA,WAAW,EAAEZ,WAAd;AAA2Ba,UAAAA,YAAY,EAAEb,WAAzC;AAAsDc,UAAAA,UAAU,EAAE;AAAlE,SAFkB,CAApB;AAID,OALD,CAMA,OAAOC,CAAP,EAAU;AACR,aAAKJ,IAAL,CAAUK,QAAV,CAAmBC,KAAnB,CAAyBC,OAAzB,GAAmC,OAAnC;AACD;AACF,KApGkB;;AAAA,SAsGnBC,WAtGmB,GAsGL,YAAY;AACxB,UAAI,KAAKV,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYW,KAAZ;AACD;AACF,KA1GkB;;AAAA,SA4GnBC,UA5GmB,GA4GN,YAAY;AACvB,UAAI,KAAKZ,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYa,IAAZ;AACD;AACF,KAhHkB;;AAAA,SAkHnBC,YAlHmB,GAkHJ,YAAY;AACzB,YAAMC,KAAK,CAAE,GAAE3B,MAAM,CAAC4B,YAAa,aAAxB,EAAsC;AAC/CC,QAAAA,MAAM,EAAE;AADuC,OAAtC,CAAL,CAGLC,IAHK,CAGA,MAAOC,QAAP,IAAoB;AACxB,cAAMA,QAAQ,CAACC,IAAT,GAAgBF,IAAhB,CAAsBjB,IAAD,IAAU;AACnC,eAAKoB,gBAAL,GAAwBpB,IAAI,CAACqB,YAA7B;AACD,SAFK,EAGLC,KAHK,CAGEC,GAAD,IAAS;AACdC,UAAAA,OAAO,CAACC,GAAR,CAAY,iCAAZ;AACD,SALK,CAAN;AAMD,OAVK,EAWLH,KAXK,CAWEC,GAAD,IAAS;AACdC,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAAZ;AACD,OAbK,CAAN;AAcD,KAjIkB;;AAAA,SAmInBC,WAnImB,GAmIL,YAAY;AACxB;AACAF,MAAAA,OAAO,CAACC,GAAR,CAAY,yBAAyB/B,aAArC;AACA,WAAKiC,QAAL,CAAc;AAAEC,QAAAA,kBAAkB,EAAE;AAAtB,OAAd;AACA,WAAKC,KAAL,GAAa,MAAM7C,EAAE,CAAC8C,eAAH,CAAmB1C,UAAnB,CAAnB;AACA,YAAM,KAAKyC,KAAL,CAAWE,IAAX,CAAgB,iBAAiBrC,aAAjC,CAAN;AACA,WAAKiC,QAAL,CAAc;AACZC,QAAAA,kBAAkB,EAAE,KADR;AAEZI,QAAAA,oBAAoB,EAAE,KAFV;AAGZC,QAAAA,oBAAoB,EAAE,KAHV;AAIZC,QAAAA,sBAAsB,EAAE;AAJZ,OAAd;AAMD,KA/IkB;;AAAA,SAiJnBC,kBAjJmB,GAiJE,YAAY;AAC/B,WAAKR,QAAL,CAAc;AAAES,QAAAA,aAAa,EAAE;AAAjB,OAAd;AAEA,YAAMC,aAAa,GAAG,KAAKpC,IAAL,CAAUqC,OAAV,CAAkBC,gBAAlB,EAAtB;AACA,YAAMC,KAAK,GAAGxD,EAAE,CAACyD,IAAH,CAAS,MAAMzD,EAAE,CAAC0D,OAAH,CAAWC,UAAX,CAAsBN,aAAtB,EAAqCO,OAArC,EAAf,CAAd,CAJ+B,CAM/B;;AACA,YAAMC,SAAS,GAAG,MAAM,KAAKC,YAAL,CAAkBN,KAAlB,CAAxB;AACA,YAAMO,YAAY,GAAG/D,EAAE,CAACwD,KAAH,CAASQ,cAAT,CAAwBH,SAAxB,EAAmC,CAACxD,UAAD,EAAaA,UAAb,CAAnC,CAArB;AAEA,YAAM4D,MAAM,GAAG,KAAKpB,KAAL,CAAWqB,OAAX,CAAmBH,YAAnB,CAAf;AACA,YAAMI,aAAa,GAAG,MAAMF,MAAM,CAACjD,IAAP,EAA5B;AACA,YAAMoD,KAAK,GAAG,MAAM,KAAKC,cAAL,CAAoBF,aAApB,EAAmC5D,gBAAnC,CAApB;AAEA,WAAKoC,QAAL,CAAc;AACZ2B,QAAAA,WAAW,EAAEF,KADD;AAEZhB,QAAAA,aAAa,EAAE,KAFH;AAGZmB,QAAAA,iBAAiB,EAAE,CAAC,KAAKC,KAAL,CAAWD;AAHnB,OAAd,EAd+B,CAoB/B;;AACA,YAAME,OAAO,GAAG,KAAKxD,IAAL,CAAUyD,MAAV,CAAiBC,UAAjB,CAA4B,IAA5B,CAAhB;AACA,YAAMC,MAAM,GAAGtE,WAAW,GAAG+C,aAAa,CAACwB,KAA3C;AACA,YAAMC,MAAM,GAAGxE,WAAW,GAAG+C,aAAa,CAAC0B,MAA3C;AACA,YAAMC,KAAK,GAAGC,IAAI,CAACC,GAAL,CAASN,MAAT,EAAiBE,MAAjB,CAAd;AACAL,MAAAA,OAAO,CAACU,SAAR,CAAkB,CAAlB,EAAqB,CAArB,EAAwB7E,WAAxB,EAAqCA,WAArC;AACAmE,MAAAA,OAAO,CAACW,SAAR,CAAkB/B,aAAlB,EAAiC,CAAjC,EAAoC,CAApC,EACkBA,aAAa,CAACwB,KAAd,GAAsBG,KADxC,EAC+C3B,aAAa,CAAC0B,MAAd,GAAuBC,KADtE,EA1B+B,CA6B/B;;AACAxB,MAAAA,KAAK,CAAC6B,OAAN;AACAxB,MAAAA,SAAS,CAACwB,OAAV;AACAtB,MAAAA,YAAY,CAACsB,OAAb;AACApB,MAAAA,MAAM,CAACoB,OAAP;AACD,KAnLkB;;AAAA,SAqLnBC,mBArLmB,GAqLG,YAAY;AAChC,WAAK3C,QAAL,CAAc;AAAES,QAAAA,aAAa,EAAE;AAAjB,OAAd;AAEA,YAAMmC,YAAY,GAAG,MAAM,KAAKxE,MAAL,CAAYyE,OAAZ,EAA3B;AAEA,YAAMC,OAAO,GAAGzF,EAAE,CAACwD,KAAH,CAASQ,cAAT,CAAwBuB,YAAxB,EAAsC,CAAClF,UAAD,EAAaA,UAAb,CAAtC,CAAhB;AACA,YAAMwD,SAAS,GAAG,MAAM,KAAKC,YAAL,CAAkB2B,OAAlB,CAAxB;AACA,YAAMxB,MAAM,GAAG,KAAKpB,KAAL,CAAWqB,OAAX,CAAmBL,SAAnB,CAAf;AACA,YAAMM,aAAa,GAAG,MAAMF,MAAM,CAACjD,IAAP,EAA5B;AACA,YAAMoD,KAAK,GAAG,MAAM,KAAKC,cAAL,CAAoBF,aAApB,EAAmC5D,gBAAnC,CAApB;AAEA,WAAKoC,QAAL,CAAc;AACZ2B,QAAAA,WAAW,EAAEF,KADD;AAEZhB,QAAAA,aAAa,EAAE,KAFH;AAGZmB,QAAAA,iBAAiB,EAAE,CAAC,KAAKC,KAAL,CAAWD;AAHnB,OAAd,EAXgC,CAiBhC;;AACA,YAAMmB,UAAU,GAAG1F,EAAE,CAACyD,IAAH,CAAQ,MAAM8B,YAAY,CAAC3B,OAAb,GAAuB+B,GAAvB,CAA2B,GAA3B,CAAd,CAAnB;AACA,YAAM3F,EAAE,CAAC0D,OAAH,CAAWkC,QAAX,CAAoBF,UAApB,EAAgC,KAAKzE,IAAL,CAAUyD,MAA1C,CAAN,CAnBgC,CAqBhC;;AACAe,MAAAA,OAAO,CAACJ,OAAR;AACAE,MAAAA,YAAY,CAACF,OAAb;AACAxB,MAAAA,SAAS,CAACwB,OAAV;AACApB,MAAAA,MAAM,CAACoB,OAAP;AACAK,MAAAA,UAAU,CAACL,OAAX;AACD,KAhNkB;;AAAA,SAkNnBvB,YAlNmB,GAkNJ,MAAON,KAAP,IAAiB;AAC9B,aAAOxD,EAAE,CAACyD,IAAH,CAAQ,MAAMD,KAAK,CAACqC,UAAN,CAAiB,CAAjB,EAAoBjC,OAApB,GAA8B+B,GAA9B,CAAkC,GAAlC,EAAuCG,GAAvC,CAA2C,CAA3C,CAAd,CAAP;AACD,KApNkB;;AAAA,SA4NnBzB,cA5NmB,GA4NF,OAAO0B,MAAP,EAAeC,IAAf,KAAwB;AACvC,YAAMC,gBAAgB,GAAG,EAAzB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,MAAM,CAACI,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACtCD,QAAAA,gBAAgB,CAACG,IAAjB,CAAsB;AAACC,UAAAA,KAAK,EAAEN,MAAM,CAACG,CAAD,CAAd;AAAmBI,UAAAA,KAAK,EAAEJ;AAA1B,SAAtB;AACD;;AACDD,MAAAA,gBAAgB,CAACM,IAAjB,CAAsB,CAACC,CAAD,EAAIC,CAAJ,KAAU;AAC9B,eAAOA,CAAC,CAACJ,KAAF,GAAUG,CAAC,CAACH,KAAnB;AACD,OAFD;AAGA,YAAMK,UAAU,GAAG,IAAIC,YAAJ,CAAiBX,IAAjB,CAAnB;AACA,YAAMY,WAAW,GAAG,IAAIC,UAAJ,CAAeb,IAAf,CAApB;;AACA,WAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAApB,EAA0BE,CAAC,EAA3B,EAA+B;AAC7BQ,QAAAA,UAAU,CAACR,CAAD,CAAV,GAAgBD,gBAAgB,CAACC,CAAD,CAAhB,CAAoBG,KAApC;AACAO,QAAAA,WAAW,CAACV,CAAD,CAAX,GAAiBD,gBAAgB,CAACC,CAAD,CAAhB,CAAoBI,KAArC;AACD;;AAED,YAAMQ,kBAAkB,GAAG,EAA3B;;AACA,WAAK,IAAIZ,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGU,WAAW,CAACT,MAAhC,EAAwCD,CAAC,EAAzC,EAA6C;AAC3CY,QAAAA,kBAAkB,CAACV,IAAnB,CAAwB;AACtBW,UAAAA,SAAS,EAAE7G,aAAa,CAAC0G,WAAW,CAACV,CAAD,CAAZ,CADF;AAEtBc,UAAAA,WAAW,EAAE,CAACN,UAAU,CAACR,CAAD,CAAV,GAAgB,GAAjB,EAAsBe,OAAtB,CAA8B,CAA9B;AAFS,SAAxB;AAID;;AACD,aAAOH,kBAAP;AACD,KAnPkB;;AAAA,SAqPnBI,gBArPmB,GAqPAC,KAAK,IAAI;AAC1B,WAAKxE,QAAL,CAAc;AAAE4B,QAAAA,iBAAiB,EAAE,CAAC,KAAKC,KAAL,CAAWD;AAAjC,OAAd;AACD,KAvPkB;;AAAA,SAyPnB6C,gBAzPmB,GAyPAD,KAAK,IAAI;AAC1B,UAAIA,KAAK,CAACE,MAAN,CAAaC,KAAb,IAAsBH,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmBnB,MAAnB,GAA4B,CAAtD,EAAyD;AACvD,aAAKxD,QAAL,CAAc;AACZ4E,UAAAA,IAAI,EAAEC,GAAG,CAACC,eAAJ,CAAoBN,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAApB,CADM;AAEZI,UAAAA,QAAQ,EAAEP,KAAK,CAACE,MAAN,CAAaC,KAAb,CAAmB,CAAnB,EAAsBK;AAFpB,SAAd;AAID;AACF,KAhQkB;;AAAA,SAkQnBC,eAlQmB,GAkQDC,SAAS,IAAI;AAC7B,cAAOA,SAAP;AACE,aAAK,QAAL;AACE,eAAKpG,WAAL;AACA;;AACF,aAAK,WAAL;AACE,eAAKkB,QAAL,CAAc;AAAC+E,YAAAA,QAAQ,EAAE,IAAX;AAAiBH,YAAAA,IAAI,EAAE;AAAvB,WAAd;AACA,eAAK5F,UAAL;AACA;;AACF;AARF;AAUD,KA7QkB;;AAGjB,SAAKZ,MAAL,GAAc,IAAd;AACA,SAAK8B,KAAL,GAAa,IAAb;AACA,SAAKT,gBAAL,GAAwB,IAAxB;AAEA,SAAKoC,KAAL,GAAa;AACXsD,MAAAA,WAAW,EAAE,KADF;AAEXJ,MAAAA,QAAQ,EAAE,EAFC;AAGXK,MAAAA,cAAc,EAAE,KAHL;AAIX3E,MAAAA,aAAa,EAAE,KAJJ;AAKXkB,MAAAA,WAAW,EAAE,EALF;AAMXC,MAAAA,iBAAiB,EAAE,IANR;AAOXvB,MAAAA,oBAAoB,EAAE,KAPX;AAQXC,MAAAA,oBAAoB,EAAE,KARX;AASXC,MAAAA,sBAAsB,EAAE,KATb;AAUXN,MAAAA,kBAAkB,EAAE;AAVT,KAAb;AAYD;;AAED,QAAMoF,iBAAN,GAA0B;AACxB,QAAK,eAAeC,MAApB,EAA6B;AAC3B,UAAI;AACF,aAAKpF,KAAL,GAAa,MAAM7C,EAAE,CAAC8C,eAAH,CAAmB,iBAAiBpC,aAApC,CAAnB,CADE,CAGF;AACA;;AACA,YAAI;AACF,gBAAMwH,EAAE,GAAG,MAAMpI,MAAM,CAACU,YAAD,EAAe,CAAf,CAAvB;AACA,gBAAM2H,IAAI,GAAG,MAAMD,EAAE,CAACE,WAAH,CAAe3H,eAAf,EACG4H,WADH,CACe5H,eADf,EAEG6H,GAFH,CAEO5H,aAFP,CAAnB;AAGA,gBAAM6H,SAAS,GAAG,IAAIC,IAAJ,CAASL,IAAI,CAACM,kBAAL,CAAwBF,SAAjC,CAAlB;AACA,gBAAM,KAAK1G,YAAL,EAAN;AACAW,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKL,gBAAjB;;AACA,cAAI,CAAC,KAAKA,gBAAN,IAA2BmG,SAAS,IAAI,IAAIC,IAAJ,CAAS,KAAKpG,gBAAd,EAAgCsG,OAAhC,EAA5C,EAAuF;AACrFlG,YAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACD,WAFD,MAGK;AACH,iBAAKE,QAAL,CAAc;AACZK,cAAAA,oBAAoB,EAAE,IADV;AAEZC,cAAAA,oBAAoB,EAAE;AAFV,aAAd;AAID;AAEF,SAlBD,CAmBA,OAAO0F,KAAP,EAAc;AACZnG,UAAAA,OAAO,CAACoG,IAAR,CAAaD,KAAb;AACAnG,UAAAA,OAAO,CAACoG,IAAR,CAAa,0CAAb;AACD;AAEF,OA7BD,CA8BA;AACA;AACA,aAAOD,KAAP,EAAc;AACZnG,QAAAA,OAAO,CAACC,GAAR,CAAY,+CAAZ;AACAD,QAAAA,OAAO,CAACC,GAAR,CAAYkG,KAAZ;AACA,aAAK9F,KAAL,GAAa,MAAM7C,EAAE,CAAC8C,eAAH,CAAmB1C,UAAnB,CAAnB;AACA,cAAM,KAAKyC,KAAL,CAAWE,IAAX,CAAgB,iBAAiBrC,aAAjC,CAAN;AACD;AACF,KAvCD,CAwCA;AAxCA,SAyCK;AACH8B,QAAAA,OAAO,CAACoG,IAAR,CAAa,0BAAb;AACA,aAAK/F,KAAL,GAAa,MAAM7C,EAAE,CAAC8C,eAAH,CAAmB1C,UAAnB,CAAnB;AACD;;AAED,SAAKuC,QAAL,CAAc;AAAEmF,MAAAA,WAAW,EAAE;AAAf,KAAd;AACA,SAAKhH,UAAL,GAhDwB,CAkDxB;;AACA,QAAI+H,UAAU,GAAG7I,EAAE,CAACyD,IAAH,CAAQ,MAAM,KAAKZ,KAAL,CAAWqB,OAAX,CAAmBlE,EAAE,CAAC8I,KAAH,CAAS,CAAC,CAAD,EAAIzI,UAAJ,EAAgBA,UAAhB,EAA4B,CAA5B,CAAT,CAAnB,CAAd,CAAjB;AACAwI,IAAAA,UAAU,CAACxD,OAAX;AACD;;AAED,QAAM0D,oBAAN,GAA6B;AAC3B,QAAI,KAAKhI,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYa,IAAZ;AACD,KAH0B,CAK3B;;;AACA,QAAI;AACF,WAAKiB,KAAL,CAAWwC,OAAX;AACD,KAFD,CAGA,OAAOhE,CAAP,EAAU,CACR;AACD;AACF;;AAuLD2H,EAAAA,MAAM,GAAG;AACP;AAAA;AACE;AAAK,QAAA,SAAS,EAAC,oBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAEE,CAAC,KAAKxE,KAAL,CAAWsD,WAAZ;AAAA;AACA,0BAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,OAAD;AAAS,QAAA,SAAS,EAAC,QAAnB;AAA4B,QAAA,IAAI,EAAC,QAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAM,QAAA,SAAS,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBADF,CADF,EAIG,GAJH;AAAA;AAIO;AAAM,QAAA,SAAS,EAAC,oBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAJP,CAHF,EAWE,KAAKtD,KAAL,CAAWsD,WAAX;AAAA;AACA,0BAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,0BAAC,MAAD;AACE,QAAA,OAAO,EAAC,SADV;AAEE,QAAA,OAAO,EAAE,KAAKZ,gBAFhB;AAGE,QAAA,SAAS,EAAC,uBAHZ;AAIE,yBAAc,sBAJhB;AAKE,yBAAe,KAAK1C,KAAL,CAAWD,iBAL5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQI;AAAM,QAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,KAAKC,KAAL,CAAWD,iBAAX;AAAA;AACE,0BAAC,aAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF;AAAA;AAEE,0BAAC,cAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAHJ,CARJ,CADA;AAAA;AAgBE,0BAAC,QAAD;AAAU,cAAI,KAAKC,KAAL,CAAWD,iBAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAK,QAAA,EAAE,EAAC,sBAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,KAAKC,KAAL,CAAWxB,oBAAX,IAAmC,KAAKwB,KAAL,CAAWvB,oBAA9C;AAAA;AACE,0BAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,KAAD;AACE,QAAA,OAAO,EAAC,MADV;AAEE,QAAA,IAAI,EAAE,KAAKuB,KAAL,CAAWxB,oBAAX,IAAmC,KAAKwB,KAAL,CAAWvB,oBAFtD;AAGE,QAAA,OAAO,EAAE,MAAM,KAAKN,QAAL,CAAc;AAAEM,UAAAA,oBAAoB,EAAE;AAAxB,SAAd,CAHjB;AAIE,QAAA,WAAW,MAJb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAS,KAAKuB,KAAL,CAAWyE,SAApB,CALtB;AAAA;AAMI;AAAK,QAAA,SAAS,EAAC,oCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,CAAC,KAAKzE,KAAL,CAAW5B,kBAAZ;AAAA;AACC,0BAAC,MAAD;AAAQ,QAAA,OAAO,EAAE,KAAKF,WAAtB;AACQ,QAAA,OAAO,EAAC,cADhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAFJ,EAOG,KAAK8B,KAAL,CAAW5B,kBAAX;AAAA;AACC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,OAAD;AAAS,QAAA,SAAS,EAAC,QAAnB;AAA4B,QAAA,IAAI,EAAC,QAAjC;AAA0C,QAAA,IAAI,EAAC,IAA/C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAM,QAAA,SAAS,EAAC,SAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BADF,CADF,EAIG,GAJH;AAAA;AAIO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0BAJP,CARJ,CANJ,CADF,CAFJ,EA4BG,KAAK4B,KAAL,CAAWtB,sBAAX;AAAA;AACC,0BAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,KAAD;AAAO,QAAA,OAAO,EAAC,SAAf;AACO,QAAA,OAAO,EAAE,MAAM,KAAKP,QAAL,CAAc;AAAEO,UAAAA,sBAAsB,EAAE;AAA1B,SAAd,CADtB;AAEO,QAAA,WAAW,MAFlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAAS,KAAKsB,KAAL,CAAWyE,SAApB,CAHN,kCADF,CA7BJ;AAAA;AAqCA,0BAAC,IAAD;AAAM,QAAA,gBAAgB,EAAC,QAAvB;AAAgC,QAAA,EAAE,EAAC,eAAnC;AAAmD,QAAA,QAAQ,EAAE,KAAKrB,eAAlE;AACM,QAAA,SAAS,EAAC,wBADhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEE,0BAAC,GAAD;AAAK,QAAA,QAAQ,EAAC,QAAd;AAAuB,QAAA,KAAK,EAAC,YAA7B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAK,QAAA,EAAE,EAAC,WAAR;AAAoB,QAAA,GAAG,EAAC,UAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAM,QAAA,SAAS,EAAC,aAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA8B,0BAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAA9B,CADF;AAAA;AAE4B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAF5B,sDADF;AAAA;AAME;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAO,QAAA,GAAG,EAAC,QAAX;AAAoB,QAAA,QAAQ,MAA5B;AAA6B,QAAA,WAAW,MAAxC;AAAyC,QAAA,KAAK,MAA9C;AAA+C,QAAA,EAAE,EAAC,QAAlD;AACO,QAAA,KAAK,EAAC,KADb;AACmB,QAAA,MAAM,EAAC,KAD1B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF,CANF;AAAA;AAaE;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,UAAD;AACE,QAAA,OAAO,EAAC,QADV;AAGE,QAAA,IAAI,EAAC,IAHP;AAIE,QAAA,OAAO,EAAE,KAAKtC,mBAJhB;AAKE,QAAA,SAAS,EAAE,KAAKd,KAAL,CAAWpB,aALxB;AAME,QAAA,IAAI,EAAC,WANP;AAOE,QAAA,WAAW,EAAC,iBAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAbF,CAFF;AAAA;AA2BE,0BAAC,GAAD;AAAK,QAAA,QAAQ,EAAC,WAAd;AAA0B,QAAA,KAAK,EAAC,8BAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,IAAD,CAAM,KAAN;AAAY,QAAA,SAAS,EAAC,MAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,IAAD,CAAM,KAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kCADF;AAAA;AACiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADjD;AAAA;AAEE,0BAAC,IAAD,CAAM,KAAN;AAAY,QAAA,SAAS,EAAC,YAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACG,KAAKoB,KAAL,CAAWkD,QAAX,GAAsB,KAAKlD,KAAL,CAAWkD,QAAjC,GAA4C,WAD/C,CAFF;AAAA;AAKE,0BAAC,IAAD,CAAM,OAAN;AACE,QAAA,QAAQ,EAAE,KAAKN,gBADjB;AAEE,QAAA,IAAI,EAAC,MAFP;AAGE,QAAA,MAAM,EAAC,SAHT;AAIE,QAAA,SAAS,EAAC,WAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QALF,CADF,EAYI,KAAK5C,KAAL,CAAW+C,IAAX;AAAA;AACA,0BAAC,QAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAK,QAAA,EAAE,EAAC,aAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,OAAD;AACE,QAAA,GAAG,EAAC,SADN;AAEE,QAAA,GAAG,EAAE,KAAK/C,KAAL,CAAW+C,IAFlB;AAGE,QAAA,KAAK,EAAE;AAACxC,UAAAA,MAAM,EAAE,GAAT;AAAcF,UAAAA,KAAK,EAAE;AAArB,SAHT;AAIE,QAAA,MAAM,EAAE,IAJV;AAKE,QAAA,WAAW,EAAE,IAAI,CALnB;AAME,QAAA,QAAQ,EAAE,CANZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CADF;AAAA;AAWE;AAAK,QAAA,SAAS,EAAC,kBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE,0BAAC,UAAD;AACE,QAAA,OAAO,EAAC,SADV;AAEE,QAAA,IAAI,EAAC,IAFP;AAGE,QAAA,QAAQ,EAAE,CAAC,KAAKL,KAAL,CAAWkD,QAHxB;AAIE,QAAA,OAAO,EAAE,KAAKvE,kBAJhB;AAKE,QAAA,SAAS,EAAE,KAAKqB,KAAL,CAAWpB,aALxB;AAME,QAAA,IAAI,EAAC,YANP;AAOE,QAAA,WAAW,EAAC,iBAPd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,CAXF,CAbJ,CA3BF,CArCA,CADF,CAhBF,EA0HI,KAAKoB,KAAL,CAAWF,WAAX,CAAuB6B,MAAvB,GAAgC,EAAhC;AAAA;AACA;AAAK,QAAA,SAAS,EAAC,wBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBADF;AAAA;AAEE;AAAQ,QAAA,GAAG,EAAC,QAAZ;AAAqB,QAAA,KAAK,EAAE7F,WAA5B;AAAyC,QAAA,MAAM,EAAEA,WAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAFF;AAAA;AAGE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAHF;AAAA;AAIE,0BAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACC,KAAKkE,KAAL,CAAWF,WAAX,CAAuB4E,GAAvB,CAA4BC,QAAD,IAAc;AACtC;AAAA;AACE,8BAAC,SAAD,CAAW,IAAX;AAAgB,YAAA,GAAG,EAAEA,QAAQ,CAACpC,SAA9B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAASoC,QAAQ,CAACpC,SAAlB,CADF,OACyCoC,QAAQ,CAACnC,WADlD;AADF;AAIH,OALA,CADD,CAJF,CA3HJ,CAZF;AADF;AA0JD;;AA5a6C","sourcesContent":["import React, { Component, Fragment } from 'react';\nimport {\n  Alert, Button, Collapse, Container, Form, Spinner, ListGroup, Tabs, Tab\n} from 'react-bootstrap';\nimport { FaCamera, FaChevronDown, FaChevronRight } from 'react-icons/fa';\nimport { openDB } from 'idb';\nimport Cropper  from 'react-cropper';\nimport * as tf from '@tensorflow/tfjs';\nimport LoadButton from '../components/LoadButton';\nimport { MODEL_CLASSES } from '../model/classes';\nimport config from '../config';\nimport './Classify.css';\nimport 'cropperjs/dist/cropper.css';\n\n\nconst MODEL_PATH = '/model/model.json';\nconst IMAGE_SIZE = 224;\nconst CANVAS_SIZE = 224;\nconst TOPK_PREDICTIONS = 5;\n\nconst INDEXEDDB_DB = 'tensorflowjs';\nconst INDEXEDDB_STORE = 'model_info_store';\nconst INDEXEDDB_KEY = 'web-model';\n\n/**\n * Class to handle the rendering of the Classify page.\n * @extends React.Component\n */\nexport default class Classify extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.webcam = null;\n    this.model = null;\n    this.modelLastUpdated = null;\n\n    this.state = {\n      modelLoaded: false,\n      filename: '',\n      isModelLoading: false,\n      isClassifying: false,\n      predictions: [],\n      photoSettingsOpen: true,\n      modelUpdateAvailable: false,\n      showModelUpdateAlert: false,\n      showModelUpdateSuccess: false,\n      isDownloadingModel: false\n    };\n  }\n\n  async componentDidMount() {\n    if (('indexedDB' in window)) {\n      try {\n        this.model = await tf.loadLayersModel('indexeddb://' + INDEXEDDB_KEY);\n\n        // Safe to assume tensorflowjs database and related object store exists.\n        // Get the date when the model was saved.\n        try {\n          const db = await openDB(INDEXEDDB_DB, 1, );\n          const item = await db.transaction(INDEXEDDB_STORE)\n                               .objectStore(INDEXEDDB_STORE)\n                               .get(INDEXEDDB_KEY);\n          const dateSaved = new Date(item.modelArtifactsInfo.dateSaved);\n          await this.getModelInfo();\n          console.log(this.modelLastUpdated);\n          if (!this.modelLastUpdated  || dateSaved >= new Date(this.modelLastUpdated).getTime()) {\n            console.log('Using saved model');\n          }\n          else {\n            this.setState({\n              modelUpdateAvailable: true,\n              showModelUpdateAlert: true,\n            });\n          }\n\n        }\n        catch (error) {\n          console.warn(error);\n          console.warn('Could not retrieve when model was saved.');\n        }\n\n      }\n      // If error here, assume that the object store doesn't exist and the model currently isn't\n      // saved in IndexedDB.\n      catch (error) {\n        console.log('Not found in IndexedDB. Loading and saving...');\n        console.log(error);\n        this.model = await tf.loadLayersModel(MODEL_PATH);\n        await this.model.save('indexeddb://' + INDEXEDDB_KEY);\n      }\n    }\n    // If no IndexedDB, then just download like normal.\n    else {\n      console.warn('IndexedDB not supported.');\n      this.model = await tf.loadLayersModel(MODEL_PATH);\n    }\n\n    this.setState({ modelLoaded: true });\n    this.initWebcam();\n\n    // Warm up model.\n    let prediction = tf.tidy(() => this.model.predict(tf.zeros([1, IMAGE_SIZE, IMAGE_SIZE, 3])));\n    prediction.dispose();\n  }\n\n  async componentWillUnmount() {\n    if (this.webcam) {\n      this.webcam.stop();\n    }\n\n    // Attempt to dispose of the model.\n    try {\n      this.model.dispose();\n    }\n    catch (e) {\n      // Assume model is not loaded or already disposed.\n    }\n  }\n\n  initWebcam = async () => {\n    try {\n      this.webcam = await tf.data.webcam(\n        this.refs.webcam,\n        {resizeWidth: CANVAS_SIZE, resizeHeight: CANVAS_SIZE, facingMode: 'environment'}\n      );\n    }\n    catch (e) {\n      this.refs.noWebcam.style.display = 'block';\n    }\n  }\n\n  startWebcam = async () => {\n    if (this.webcam) {\n      this.webcam.start();\n    }\n  }\n\n  stopWebcam = async () => {\n    if (this.webcam) {\n      this.webcam.stop();\n    }\n  }\n\n  getModelInfo = async () => {\n    await fetch(`${config.API_ENDPOINT}/model_info`, {\n      method: 'GET',\n    })\n    .then(async (response) => {\n      await response.json().then((data) => {\n        this.modelLastUpdated = data.last_updated;\n      })\n      .catch((err) => {\n        console.log('Unable to get parse model info.');\n      });\n    })\n    .catch((err) => {\n      console.log('Unable to get model info');\n    });\n  }\n\n  updateModel = async () => {\n    // Get the latest model from the server and refresh the one saved in IndexedDB.\n    console.log('Updating the model: ' + INDEXEDDB_KEY);\n    this.setState({ isDownloadingModel: true });\n    this.model = await tf.loadLayersModel(MODEL_PATH);\n    await this.model.save('indexeddb://' + INDEXEDDB_KEY);\n    this.setState({\n      isDownloadingModel: false,\n      modelUpdateAvailable: false,\n      showModelUpdateAlert: false,\n      showModelUpdateSuccess: true\n    });\n  }\n\n  classifyLocalImage = async () => {\n    this.setState({ isClassifying: true });\n\n    const croppedCanvas = this.refs.cropper.getCroppedCanvas();\n    const image = tf.tidy( () => tf.browser.fromPixels(croppedCanvas).toFloat());\n\n    // Process and resize image before passing in to model.\n    const imageData = await this.processImage(image);\n    const resizedImage = tf.image.resizeBilinear(imageData, [IMAGE_SIZE, IMAGE_SIZE]);\n\n    const logits = this.model.predict(resizedImage);\n    const probabilities = await logits.data();\n    const preds = await this.getTopKClasses(probabilities, TOPK_PREDICTIONS);\n\n    this.setState({\n      predictions: preds,\n      isClassifying: false,\n      photoSettingsOpen: !this.state.photoSettingsOpen\n    });\n\n    // Draw thumbnail to UI.\n    const context = this.refs.canvas.getContext('2d');\n    const ratioX = CANVAS_SIZE / croppedCanvas.width;\n    const ratioY = CANVAS_SIZE / croppedCanvas.height;\n    const ratio = Math.min(ratioX, ratioY);\n    context.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);\n    context.drawImage(croppedCanvas, 0, 0,\n                      croppedCanvas.width * ratio, croppedCanvas.height * ratio);\n\n    // Dispose of tensors we are finished with.\n    image.dispose();\n    imageData.dispose();\n    resizedImage.dispose();\n    logits.dispose();\n  }\n\n  classifyWebcamImage = async () => {\n    this.setState({ isClassifying: true });\n\n    const imageCapture = await this.webcam.capture();\n\n    const resized = tf.image.resizeBilinear(imageCapture, [IMAGE_SIZE, IMAGE_SIZE]);\n    const imageData = await this.processImage(resized);\n    const logits = this.model.predict(imageData);\n    const probabilities = await logits.data();\n    const preds = await this.getTopKClasses(probabilities, TOPK_PREDICTIONS);\n\n    this.setState({\n      predictions: preds,\n      isClassifying: false,\n      photoSettingsOpen: !this.state.photoSettingsOpen\n    });\n\n    // Draw thumbnail to UI.\n    const tensorData = tf.tidy(() => imageCapture.toFloat().div(255));\n    await tf.browser.toPixels(tensorData, this.refs.canvas);\n\n    // Dispose of tensors we are finished with.\n    resized.dispose();\n    imageCapture.dispose();\n    imageData.dispose();\n    logits.dispose();\n    tensorData.dispose();\n  }\n\n  processImage = async (image) => {\n    return tf.tidy(() => image.expandDims(0).toFloat().div(127).sub(1));\n  }\n\n  /**\n   * Computes the probabilities of the topK classes given logits by computing\n   * softmax to get probabilities and then sorting the probabilities.\n   * @param logits Tensor representing the logits from MobileNet.\n   * @param topK The number of top predictions to show.\n   */\n  getTopKClasses = async (values, topK) => {\n    const valuesAndIndices = [];\n    for (let i = 0; i < values.length; i++) {\n      valuesAndIndices.push({value: values[i], index: i});\n    }\n    valuesAndIndices.sort((a, b) => {\n      return b.value - a.value;\n    });\n    const topkValues = new Float32Array(topK);\n    const topkIndices = new Int32Array(topK);\n    for (let i = 0; i < topK; i++) {\n      topkValues[i] = valuesAndIndices[i].value;\n      topkIndices[i] = valuesAndIndices[i].index;\n    }\n\n    const topClassesAndProbs = [];\n    for (let i = 0; i < topkIndices.length; i++) {\n      topClassesAndProbs.push({\n        className: MODEL_CLASSES[topkIndices[i]],\n        probability: (topkValues[i] * 100).toFixed(2)\n      });\n    }\n    return topClassesAndProbs;\n  }\n\n  handlePanelClick = event => {\n    this.setState({ photoSettingsOpen: !this.state.photoSettingsOpen });\n  }\n\n  handleFileChange = event => {\n    if (event.target.files && event.target.files.length > 0) {\n      this.setState({\n        file: URL.createObjectURL(event.target.files[0]),\n        filename: event.target.files[0].name\n      });\n    }\n  }\n\n  handleTabSelect = activeKey => {\n    switch(activeKey) {\n      case 'camera':\n        this.startWebcam();\n        break;\n      case 'localfile':\n        this.setState({filename: null, file: null});\n        this.stopWebcam();\n        break;\n      default:\n    }\n  }\n\n  render() {\n    return (\n      <div className=\"Classify container\">\n\n      { !this.state.modelLoaded &&\n        <Fragment>\n          <Spinner animation=\"border\" role=\"status\">\n            <span className=\"sr-only\">Cargando...</span>\n          </Spinner>\n          {' '}<span className=\"loading-model-text\">Cargando Modelo</span>\n        </Fragment>\n      }\n\n      { this.state.modelLoaded &&\n        <Fragment>\n        <Button\n          variant='primary'\n          onClick={this.handlePanelClick}\n          className=\"classify-panel-header\"\n          aria-controls=\"photo-selection-pane\"\n          aria-expanded={this.state.photoSettingsOpen}\n          >\n          Toma o selecciona una foto para clasificar\n            <span className='panel-arrow'>\n            { this.state.photoSettingsOpen\n              ? <FaChevronDown />\n              : <FaChevronRight />\n            }\n            </span>\n          </Button>\n          <Collapse in={this.state.photoSettingsOpen}>\n            <div id=\"photo-selection-pane\">\n            { this.state.modelUpdateAvailable && this.state.showModelUpdateAlert &&\n                <Container>\n                  <Alert\n                    variant=\"info\"\n                    show={this.state.modelUpdateAvailable && this.state.showModelUpdateAlert}\n                    onClose={() => this.setState({ showModelUpdateAlert: false})}\n                    dismissible>\n                      An update for the <strong>{this.state.modelType}</strong> El modelo esta disponible.\n                      <div className=\"d-flex justify-content-center pt-1\">\n                        {!this.state.isDownloadingModel &&\n                          <Button onClick={this.updateModel}\n                                  variant=\"outline-info\">\n                            Update\n                          </Button>\n                        }\n                        {this.state.isDownloadingModel &&\n                          <div>\n                            <Spinner animation=\"border\" role=\"status\" size=\"sm\">\n                              <span className=\"sr-only\">Descargando...</span>\n                            </Spinner>\n                            {' '}<strong>Descargando...</strong>\n                          </div>\n                        }\n                      </div>\n                  </Alert>\n                </Container>\n              }\n              {this.state.showModelUpdateSuccess &&\n                <Container>\n                  <Alert variant=\"success\"\n                         onClose={() => this.setState({ showModelUpdateSuccess: false})}\n                         dismissible>\n                    The <strong>{this.state.modelType}</strong> El modelo se ha actualizado!\n                  </Alert>\n                </Container>\n              }\n            <Tabs defaultActiveKey=\"camera\" id=\"input-options\" onSelect={this.handleTabSelect}\n                  className=\"justify-content-center\">\n              <Tab eventKey=\"camera\" title=\"Tomar Foto\">\n                <div id=\"no-webcam\" ref=\"noWebcam\">\n                  <span className=\"camera-icon\"><FaCamera /></span>\n                  No se detect una camara. <br />\n                  Por favor use un dispositivo o cargue una imagen.\n                </div>\n                <div className=\"webcam-box-outer\">\n                  <div className=\"webcam-box-inner\">\n                    <video ref=\"webcam\" autoPlay playsInline muted id=\"webcam\"\n                           width=\"448\" height=\"448\">\n                    </video>\n                  </div>\n                </div>\n                <div className=\"button-container\">\n                  <LoadButton\n                    variant=\"custom\"\n\n                    size=\"lg\"\n                    onClick={this.classifyWebcamImage}\n                    isLoading={this.state.isClassifying}\n                    text=\"Clasifcar\"\n                    loadingText=\"Clasificando...\"\n                  />\n                </div>\n              </Tab>\n              <Tab eventKey=\"localfile\" title=\"Selecccionar del dispositivo\">\n                <Form.Group controlId=\"file\">\n                  <Form.Label>Seleccionar un archivo</Form.Label><br />\n                  <Form.Label className=\"imagelabel\">\n                    {this.state.filename ? this.state.filename : 'Buscar...'}\n                  </Form.Label>\n                  <Form.Control\n                    onChange={this.handleFileChange}\n                    type=\"file\"\n                    accept=\"image/*\"\n                    className=\"imagefile\" />\n                </Form.Group>\n                { this.state.file &&\n                  <Fragment>\n                    <div id=\"local-image\">\n                      <Cropper\n                        ref=\"cropper\"\n                        src={this.state.file}\n                        style={{height: 400, width: '100%'}}\n                        guides={true}\n                        aspectRatio={1 / 1}\n                        viewMode={2}\n                      />\n                    </div>\n                    <div className=\"button-container\">\n                      <LoadButton\n                        variant=\"primary\"\n                        size=\"lg\"\n                        disabled={!this.state.filename}\n                        onClick={this.classifyLocalImage}\n                        isLoading={this.state.isClassifying}\n                        text=\"Clasificar\"\n                        loadingText=\"Clasificando...\"\n                      />\n                    </div>\n                  </Fragment>\n                }\n              </Tab>\n            </Tabs>\n            </div>\n          </Collapse>\n          { this.state.predictions.length > 70 &&\n            <div className=\"classification-results\">\n              <h3>Predicciones</h3>\n              <canvas ref=\"canvas\" width={CANVAS_SIZE} height={CANVAS_SIZE} />\n              <br />\n              <ListGroup>\n              {this.state.predictions.map((category) => {\n                  return (\n                    <ListGroup.Item key={category.className}>\n                      <strong>{category.className}</strong> {category.probability}%</ListGroup.Item>\n                  );\n              })}\n              </ListGroup>\n            </div>\n          }\n          </Fragment>\n        }\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}